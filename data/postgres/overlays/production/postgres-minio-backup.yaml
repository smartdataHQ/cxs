apiVersion: pgv2.percona.com/v2
kind: PerconaPGCluster
metadata:
  name: cxs-pg
spec:
  backups:
    pgbackrest:
      configuration:
        - secret:
            name: postgres-minio-backup-credentials
      global:
        # Configuration for "repo2" (MinIO S3)
        repo2-retention-full: "8"       # Keep more backups offsite
        repo2-retention-full-type: count
        repo2-retention-archive: "4"
        repo2-retention-diff: "14"
        repo2-s3-uri-style: path         # Required for MinIO
        repo2-storage-verify-tls: "n"      # Use HTTP instead of HTTPS
      repos:
        - name: repo1
          schedules:
            full: "0 0 * * 6"  # every Saturday at 00:00
            differential: "0 0 * * 0-5"  # every day (except Saturday) at 00:00
          volume:
            volumeClaimSpec:
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: 300Gi
        - name: repo2
          schedules:
            full: "0 2 * * 6"      # Saturday 02:00 (offset from repo1)
            differential: "0 2 * * 0-5"  # Daily 02:00
          s3:
            bucket: "backups"
            endpoint: "https://minio.storage.svc.cluster.local:9025" # this points to the c001db{1:3} data cluster
            region: "minio"