apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: data

helmCharts:
  - name: kafka
    repo: oci://registry-1.docker.io/bitnamicharts
    version: 28.0.1
    namespace: data
    releaseName: kafka
    valuesInline:
      image:
        registry: docker.io
        repository: bitnamilegacy/kafka
      
      broker:
        replicaCount: 3 # Increase the number of replicas to 3
        heapOpts:  -Xmx8192m -Xms4096m # Increase the max heap size to 8GB
      controller:
        replicaCount: 0
      kraft:
        enabled: false
      resourcesPreset: large # Set a preset profile or define resources

      externalZookeeper:
        servers: [zookeeper.data.svc.cluster.local]

      sasl:  # prevent the regeneration of kafka passwords
        existingSecret: "kafka-user-passwords"

      metrics:
        kafka:
          enabled: true
          image:
            repository: bitnamilegacy/kafka-exporter-archived
        jmx:
          enabled: true
          image:
            repository: bitnamilegacy/jmx-exporter
          kafkaJmxPort: 5555
        serviceMonitor:
          enabled: true
          namespace: cattle-monitoring-system
