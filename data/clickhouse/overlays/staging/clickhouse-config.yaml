# Setup ClickHouse Keeper settings (staging)
apiVersion: v1
kind: ConfigMap
metadata:
  name: clickhouse-config
data:
  users.xml: |-
    <clickhouse>
        <profiles>
            <default>
            </default>
            <readonly>
                <readonly>1</readonly>
            </readonly>
        </profiles>
        <users>
            <default>
                <password from_env="CLICKHOUSE_PASSWORD"/>
                <networks>
                    <ip>::/0</ip>
                </networks>
                <profile>default</profile>
                <quota>default</quota>
                <access_management>1</access_management>
                <named_collection_control>1</named_collection_control>
            </default>
        </users>
        <quotas>
            <default>
                <interval>
                    <duration>3600</duration>
                    <queries>0</queries>
                    <errors>0</errors>
                    <result_rows>0</result_rows>
                    <read_rows>0</read_rows>
                    <execution_time>0</execution_time>
                </interval>
            </default>
        </quotas>
    </clickhouse>
  storage_config.xml: |-
    <clickhouse>
        <storage_configuration>
            <disks>
                <default>
                    <keep_free_space_bytes>0</keep_free_space_bytes>
                </default>
                <data>
                    <path>/data/</path>
                    <keep_free_space_bytes>0</keep_free_space_bytes>
                </data>
            </disks>
            <policies>
                <local>
                    <volumes>
                        <main>
                            <disk>data</disk>
                        </main>
                    </volumes>
                </local>
            </policies>
        </storage_configuration>
    </clickhouse>
  config.xml: |-
    <clickhouse>
        <logger>
            <level>information</level>
            <console>true</console>
            <console>1</console>
        </logger>
        <query_log>
            <database>system</database>
            <table>query_log</table>
        </query_log>
        <listen_host>0.0.0.0</listen_host>
        <http_port>8123</http_port>
        <tcp_port>9000</tcp_port>
        <interserver_http_port>9009</interserver_http_port>
        <user_directories>
            <users_xml>
                <path>users.xml</path>
            </users_xml>
            <local_directory>
                <path>/var/lib/clickhouse/access/</path>
            </local_directory>
        </user_directories>
        <distributed_ddl>
            <path>/clickhouse/task_queue/ddl</path>
        </distributed_ddl>
        <macros>
            <cluster>default</cluster>
            <shard>1</shard>
            <replica from_env="HOSTNAME"/>
        </macros>
    </clickhouse>


