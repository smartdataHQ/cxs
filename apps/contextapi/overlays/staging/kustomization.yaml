images:
  - name: quicklookup/contextapi
    newTag: b387480

configMapGenerator:
  - name: contextapi-config
    behavior: merge
    literals:
      - SENTRY_ENVIRONMENT=contextsuite-staging
      - NEXT_PUBLIC_SENTRY_DSN=""
      - SENTRY_DSN=""
      - CLICKHOUSE_CONNECTION=http://clickhouse.data:8123

resources:
  - ../../base

patches:
  - path: database-migration.yaml
  - target:
      kind: Ingress
      name: contextapi
    patch: |
      - op: replace
        path: /metadata/annotations/cert-manager.io~1cluster-issuer
        value: "letsencrypt-prod"
      - op: replace
        path: /spec/tls/0/secretName
        value: "contextapi-tls"
      - "op": replace
        "path": /spec/rules/0/host
        "value": &fqdn app.contextsuite.dev
      - "op": replace
        "path": /spec/tls/0/hosts/0
        "value": *fqdn  # <- this is a YAML anchor
      
