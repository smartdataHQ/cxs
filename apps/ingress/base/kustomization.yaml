apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ingress

resources:
  - deployment.yaml
  - service.yaml
  - ingress.yaml
  - autoscaler.yaml

configMapGenerator:
  - name: ingress-config
    literals:
      # Kafka - External Cluster (Java client - explicitly disable SASL)
      - KAFKA_URI_OLD=kafka-broker-0.kafka-broker-headless.data.svc.cluster.local:9092,kafka-broker-1.kafka-broker-headless.data.svc.cluster.local:9092,kafka-broker-2.kafka-broker-headless.data.svc.cluster.local:9092
      - KAFKA_HOST_OLD=kafka-broker-0.kafka-broker-headless.data.svc.cluster.local:9092,kafka-broker-1.kafka-broker-headless.data.svc.cluster.local:9092,kafka-broker-2.kafka-broker-headless.data.svc.cluster.local:9092
      - KAFKA_URI=c001db1:9092,c001db2:9092,c001db3:9092
      - KAFKA_HOST=c001db1:9092,c001db2:9092,c001db3:9092
      - KAFKA_PORT=9092
      - KAFKA_USER=""
      - KAFKA_SECURITY_PROTOCOL=PLAINTEXT
      - KAFKA_SASL_MECHANISM=""
      - KAFKA_SASL_ENABLED=false
      # Spring Boot Kafka properties to override auto-configuration
      - SPRING_KAFKA_SECURITY_PROTOCOL=PLAINTEXT
      - SPRING_KAFKA_PROPERTIES_SECURITY_PROTOCOL=PLAINTEXT
      - SPRING_KAFKA_PROPERTIES_SASL_MECHANISM=""
      # Redis
      - REDIS_HOST=redis-master.data
      - REDIS_PORT=6379
      - REDIS_DB=0
      - REDIS_LOCAL=true
      # Postgres
      - POSTGRES_HOST=cxs-pg-pgbouncer.data
      - POSTGRES_URI=jdbc:postgresql://cxs-pg-pgbouncer.data:5432/ssp
      - POSTGRES_USER=cxs-pg
      # Neo4j
      - NEO4J_URI=neo4j://neo4j.data:7687
      - NEO4J_HOST=neo4j.data
      - NEO4J_USER=admin
      - NEO4J_DATABASE=contextsuite
      # S3
      - S3_REGION=ams3
      - S3_ENDPOINT=https://cxs.ingression.ams3.digitaloceanspaces.com
      # Spring
      - SPRING_PROFILES_ACTIVE=prod